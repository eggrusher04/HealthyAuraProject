{"ast":null,"code":"import _objectSpread from\"D:/Documents/GitHub/2006-SCSD-16/Lab3/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useEffect,useState}from'react';import{mockApi}from'../services/mockApi';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);export function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=useState(null);const[lockInfo,setLockInfo]=useState({});// {username: {attempts, lockedUntil}}\nuseEffect(()=>{const raw=localStorage.getItem('healthyaura_user');if(raw)setUser(JSON.parse(raw));},[]);const signIn=async(username,password)=>{// client-side check for lockout\nconst info=lockInfo[username];if(info&&info.lockedUntil&&new Date(info.lockedUntil)>new Date()){throw new Error('Account locked. Try later.');}const res=await mockApi.signIn(username,password);if(res.success){setUser(res.user);localStorage.setItem('healthyaura_user',JSON.stringify(res.user));// reset attempts\nsetLockInfo(s=>_objectSpread(_objectSpread({},s),{},{[username]:{attempts:0}}));return res.user;}else{// increment attempts and possibly lock\nsetLockInfo(s=>{const curr=s[username]||{attempts:0};const attempts=curr.attempts+1;const lockedUntil=attempts>=3?new Date(Date.now()+30*60*1000).toISOString():curr.lockedUntil;return _objectSpread(_objectSpread({},s),{},{[username]:{attempts,lockedUntil}});});throw new Error('The username or password is incorrect. Please try again.');}};const signOut=()=>{setUser(null);localStorage.removeItem('healthyaura_user');};const signUp=async payload=>{const res=await mockApi.signUp(payload);if(res.success){setUser(res.user);localStorage.setItem('healthyaura_user',JSON.stringify(res.user));}return res;};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,signIn,signOut,signUp},children:children});}","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","mockApi","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","user","setUser","lockInfo","setLockInfo","raw","localStorage","getItem","JSON","parse","signIn","username","password","info","lockedUntil","Date","Error","res","success","setItem","stringify","s","_objectSpread","attempts","curr","now","toISOString","signOut","removeItem","signUp","payload","Provider","value"],"sources":["D:/Documents/GitHub/2006-SCSD-16/Lab3/frontend/src/contexts/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { mockApi } from '../services/mockApi';\r\n\r\nconst AuthContext = createContext();\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [lockInfo, setLockInfo] = useState({}); // {username: {attempts, lockedUntil}}\r\n\r\n  useEffect(() => {\r\n    const raw = localStorage.getItem('healthyaura_user');\r\n    if (raw) setUser(JSON.parse(raw));\r\n  }, []);\r\n\r\n  const signIn = async (username, password) => {\r\n    // client-side check for lockout\r\n    const info = lockInfo[username];\r\n    if (info && info.lockedUntil && new Date(info.lockedUntil) > new Date()) {\r\n      throw new Error('Account locked. Try later.');\r\n    }\r\n\r\n    const res = await mockApi.signIn(username, password);\r\n    if (res.success) {\r\n      setUser(res.user);\r\n      localStorage.setItem('healthyaura_user', JSON.stringify(res.user));\r\n      // reset attempts\r\n      setLockInfo((s) => ({ ...s, [username]: { attempts: 0 } }));\r\n      return res.user;\r\n    } else {\r\n      // increment attempts and possibly lock\r\n      setLockInfo((s) => {\r\n        const curr = s[username] || { attempts: 0 };\r\n        const attempts = curr.attempts + 1;\r\n        const lockedUntil = attempts >= 3 ? new Date(Date.now() + 30*60*1000).toISOString() : curr.lockedUntil;\r\n        return { ...s, [username]: { attempts, lockedUntil } };\r\n      });\r\n      throw new Error('The username or password is incorrect. Please try again.');\r\n    }\r\n  };\r\n\r\n  const signOut = () => {\r\n    setUser(null);\r\n    localStorage.removeItem('healthyaura_user');\r\n  };\r\n\r\n  const signUp = async (payload) => {\r\n    const res = await mockApi.signUp(payload);\r\n    if (res.success) {\r\n      setUser(res.user);\r\n      localStorage.setItem('healthyaura_user', JSON.stringify(res.user));\r\n    }\r\n    return res;\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, signIn, signOut, signUp }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}