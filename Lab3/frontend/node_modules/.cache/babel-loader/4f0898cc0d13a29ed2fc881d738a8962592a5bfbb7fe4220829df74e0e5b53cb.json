{"ast":null,"code":"import _objectSpread from\"C:/Users/rusha/OneDrive/Documents/GitHub/2006-SCSD-16/Lab3/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useEffect,useState}from'react';import API from\"../services/api\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);export function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=useState(null);const[lockInfo,setLockInfo]=useState({});// {username: {attempts, lockedUntil}}\nuseEffect(()=>{const savedUser=localStorage.getItem('healthyaura_user');if(savedUser){const parsed=JSON.parse(savedUser);setUser(parsed);if(parsed.token){API.defaults.headers.common[\"Authorization\"]='Bearer ${parsed.token}';}}},[]);const signIn=async(username,password)=>{// client-side check for lockout\nconst info=lockInfo[username];if(info&&info.lockedUntil&&new Date(info.lockedUntil)>new Date()){throw new Error('Account locked. Try later.');}try{const res=await API.post(\"/auth/login\",{\"username\":username,\"password\":password});console.log(\"Login response\",res.data);const{token,username:uname,role}=res.data;if(!token)throw new Error(\"Invalid response from server\");const userData={username:uname,role};localStorage.setItem(\"token\",token);localStorage.setItem(\"healthyaura_user\",JSON.stringify(userData));API.defaults.headers.common[\"Authorization\"]='Bearer ${token}';setUser(userData);setLockInfo(s=>_objectSpread(_objectSpread({},s),{},{[username]:{attempts:0}}));return userData;}catch(err){// Failed login attempt → increment\nsetLockInfo(s=>{const curr=s[username]||{attempts:0};const attempts=curr.attempts+1;const lockedUntil=attempts>=3?new Date(Date.now()+30*60*1000).toISOString():curr.lockedUntil;return _objectSpread(_objectSpread({},s),{},{[username]:{attempts,lockedUntil}});});throw new Error(\"The username or password is incorrect. Please try again.\");}};const signOut=()=>{localStorage.removeItem(\"token\");localStorage.removeItem('healthyaura_user');delete API.defaults.headers.common[\"Authorization\"];setUser(null);};const signUp=async payload=>{const res=await API.post(\"/auth/signup\",payload);console.log(\"Signup response:\",res.data);const{token,username,role}=res.data;const userData={username,role};localStorage.setItem(\"token\",token);localStorage.setItem(\"healthyaura_user\",JSON.stringify(userData));API.defaults.headers.common[\"Authorization\"]='Bearer ${token}';setUser(userData);return res.data;};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,signIn,signOut,signUp},children:children});}","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","API","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","user","setUser","lockInfo","setLockInfo","savedUser","localStorage","getItem","parsed","JSON","parse","token","defaults","headers","common","signIn","username","password","info","lockedUntil","Date","Error","res","post","console","log","data","uname","role","userData","setItem","stringify","s","_objectSpread","attempts","err","curr","now","toISOString","signOut","removeItem","signUp","payload","Provider","value"],"sources":["C:/Users/rusha/OneDrive/Documents/GitHub/2006-SCSD-16/Lab3/frontend/src/contexts/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport API from \"../services/api\";\r\n\r\nconst AuthContext = createContext();\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [lockInfo, setLockInfo] = useState({}); // {username: {attempts, lockedUntil}}\r\n\r\n  useEffect(() => {\r\n    const savedUser = localStorage.getItem('healthyaura_user');\r\n    if (savedUser) {\r\n        const parsed = JSON.parse(savedUser);\r\n        setUser(parsed);\r\n        if(parsed.token){\r\n            API.defaults.headers.common[\"Authorization\"] = 'Bearer ${parsed.token}';\r\n        }\r\n    }\r\n  }, []);\r\n\r\n  const signIn = async (username, password) => {\r\n    // client-side check for lockout\r\n    const info = lockInfo[username];\r\n    if (info && info.lockedUntil && new Date(info.lockedUntil) > new Date()) {\r\n      throw new Error('Account locked. Try later.');\r\n    }\r\n\r\n    try{\r\n        const res = await API.post(\"/auth/login\", { \"username\": username, \"password\": password, });\r\n        console.log(\"Login response\",res.data);\r\n        const { token, username: uname, role } = res.data;\r\n\r\n        if(!token) throw new Error(\"Invalid response from server\");\r\n\r\n        const userData = { username: uname, role };\r\n\r\n        localStorage.setItem(\"token\", token);\r\n        localStorage.setItem(\"healthyaura_user\", JSON.stringify(userData));\r\n\r\n        API.defaults.headers.common[\"Authorization\"] = 'Bearer ${token}'\r\n        setUser(userData);\r\n        setLockInfo((s) => ({ ...s, [username]: { attempts: 0} }));\r\n        return userData;\r\n    } catch(err){\r\n        // Failed login attempt → increment\r\n              setLockInfo((s) => {\r\n                const curr = s[username] || { attempts: 0 };\r\n                const attempts = curr.attempts + 1;\r\n                const lockedUntil =\r\n                  attempts >= 3\r\n                    ? new Date(Date.now() + 30 * 60 * 1000).toISOString()\r\n                    : curr.lockedUntil;\r\n                return { ...s, [username]: { attempts, lockedUntil } };\r\n              });\r\n              throw new Error(\"The username or password is incorrect. Please try again.\");\r\n    }\r\n\r\n  };\r\n\r\n  const signOut = () => {\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem('healthyaura_user');\r\n    delete API.defaults.headers.common[\"Authorization\"];\r\n    setUser(null);\r\n  };\r\n\r\n  const signUp = async (payload) => {\r\n    const res = await API.post(\"/auth/signup\", payload);\r\n    console.log(\"Signup response:\", res.data);\r\n\r\n    const { token, username, role } = res.data;\r\n    const userData = { username, role };\r\n\r\n    localStorage.setItem(\"token\", token);\r\n    localStorage.setItem(\"healthyaura_user\", JSON.stringify(userData));\r\n\r\n    API.defaults.headers.common[\"Authorization\"] = 'Bearer ${token}';\r\n    setUser(userData);\r\n\r\n    return res.data;\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, signIn, signOut, signUp }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}